# AI SDK v5 → v6 마이그레이션 전략

## 📋 개요

**목적**: AI SDK v5에서 v6로 안정하게 마이그레이션하여 기존 코드를 최소한 영향 없이 업데이트

**배경**: 현재 Annai 프로젝트에서 v5 사용 중

---

## 🎯 마이그레이션 전략

### 전략 1: 점진적 마이그레이션 (Progressive Migration)

**장점**:
- ✅ 새로운 기능 호환성 유지
- ✅ 기존 코드 최소 영향
- ✅ 점진적으로 변경하여 문제 발견 용이

**단계**:
1. v5 유지 기능 유지 (최소 1-2주)
2. v6으로 점진적 마이그레이션
3. 테스트 및 검증
4. 문서 업데이트

### 전략 2: 점진적 마이그레이션 (Progressive)

**장점**:
- ✅ 안정성 높음
- ✅ 사용자 경험 저해
- ✅ 롤백 가능

**단계**:
1. v5 유지 기능 유지
2. v6 유지 기능 추가
3. 호환성 테스트
4. 롤백 계획

### 전략 3: 점진적 마이그레이션 (Progressive) - 권장

**장점**:
- ✅ 안정성 높음
- ✅ 사용자 경험 저해
- ✅ 롤백 가능
- ✅ 장기적 대응

**단계**:
1. v5 유지 기능 유지 (최소 1주)
2. v6 유지 기능 추가 (최소 2-3주)
3. v5와 v6 공존 기능 유지
4. 테스트 및 검증 (최소 1주)
5. v5에서 v6로 완전 마이그레이션 (최소 1-2주)

---

## 📅 세부 상세 계획

### Phase 1: v5 유지 기능 유지 (1-2주)

**목표**: v5의 `BuildMessage`와 `ModelMessage` 타입을 `UIMessage`와 `readUIMessageStream`로 점진적 변경

**작업**:
1. [`lib/ai/client.ts`](lib/ai/client.ts:1) 업데이트
   - `BuildMessage` → `UIMessage` 변경
   - `ModelMessage` 타입 사용
   - `readBuildMessageStream` → `readUIMessageStream` 추가
2. [`lib/chat/manager.ts`](lib/chat/manager.ts:1) 업데이트
   - `UIMessage` 타입 사용
   - 스트리밍 처리 로직 수정

**영향**:
- ✅ 기존 코드 최소 변경 (v5 유지 기능 제거)
- ✅ 새로운 기능 호환성 유지

### Phase 2: v6 유지 기능 추가 (2-3주)

**목표**: v6의 새로운 기능을 추가하여 향상된 기능 유지

**작업**:
1. [`lib/ai/client.ts`](lib/ai/client.ts:1) 업데이트
   - `UIMessage` → `BuildMessage` 변경 완료
   - `readUIMessageStream` → `readBuildMessageStream` 변경 완료
   - `maxToolRoundtrips` 기능 추가
2. [`lib/chat/manager.ts`](lib/chat/manager.ts:1) 업데이트
   - v6 새로운 기능 지원 추가

**영향**:
- ✅ v6의 새로운 기능 사용 가능
- ✅ v5와 v6 공존 기능 유지

### Phase 3: 호환성 테스트 (1주)

**목표**: v5와 v6 호환성 검증

**작업**:
1. 크로스 브라우저 테스트
2. 기능 테스트
3. 에러 처리 확인

**영향**:
- ✅ 호환성 검증 완료
- ✅ 기능 정상 작동 확인

### Phase 4: 롤백 계획 (1주)

**목표**: v5에서 v6으로 완전 마이그레이션 계획 수립

**작업**:
1. 롤백 일정 수립
2. 마이그레이션 완료 후 v5 제거

**영향**:
- ✅ 명확한 롤백 계획
- ✅ 안정한 마이그레이션

### Phase 5: v5 제거 (최소 1주)

**목표**: v5 사용 중단계

**작업**:
1. v5 사용 코드 제거
2. v6으로 완전 이전

**영향**:
- ✅ v5 사용 중단계 완료
- ✅ v6으로 완전 이전

---

## 📊 시간표 (추정)

| 단계 | 소요 시간 | 비고 |
|------|----------|------|
| Phase 1 | 1-2주 | 중간 |
| Phase 2 | 2-3주 | 중간 |
| Phase 3 | 1주 | 짧음 |
| Phase 4 | 1주 | 짧음 |
| Phase 5 | 1주 | 짧음 |

---

## 🎯 추천 사항

1. **테스트 우선**: 각 단계 완료 후 전체 테스트 수행
2. **문서화**: 마이그레이션 가이드 작성
3. **백업**: 각 단계 완료 후 백업 생성
4. **점진적 접근**: 단계별로 나누어 접근하여 문제 해결

---

## 📝 다음 단계

사용자와 함께 최선의 결정을 내립니다. 다음 중 하나를 선택해 주세요:

1. **옵션 1**: v5 유지 기능 유지 (1-2주)
2. **옵션 2**: v6 유지 기능 추가 (2-3주)
3. **옵션 3**: 호환성 테스트 (1주)
4. **옵션 4**: 롤백 계획 (1주)
5. **옵션 5**: v5 제거 (1주)

---

*문서 생성일: 2026-01-18*
